<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>八年級的回憶攻擊</title>
  <style>
    :root {
      --primary:#a67c52;
      --primary-hover:#8c6239;
      --bg:#fdf8f2;
      --card:#fffaf5;
      --text:#4a3b2b;
    }
    *{box-sizing:border-box} 
    body{
      margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:var(--bg); color:var(--text);
      -webkit-tap-highlight-color: transparent;
    }
    .wrap{max-width:720px;margin:0 auto;padding:16px 16px 64px}
    header{text-align:center;margin:16px 0 24px}
    h1{
      font-size:28px;
      margin:0;
      font-weight:700;
    }
    .card{background:var(--card);border-radius:16px;padding:16px;
      box-shadow:0 6px 20px rgba(0,0,0,.06)}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .btn{
      appearance:none;border:none;border-radius:12px;padding:12px 16px;
      background:var(--primary);color:#fff;font-weight:600;cursor:pointer;
      width:100%;transition:background .2s;
    }
    .btn:hover{background:var(--primary-hover);}
    .btn[disabled]{opacity:.5;cursor:not-allowed}
    .q-text{font-size:18px;line-height:1.5;margin:0 0 12px}
    .choice{border:1px solid #e5e7eb;border-radius:12px;padding:12px;
      display:flex;align-items:center;gap:10px;background:#fff}
    .choice input{width:20px;height:20px}
    .meta{display:flex;justify-content:space-between;align-items:center;font-size:14px;color:#6b7280;margin:8px 0 16px}
    .pill{padding:6px 10px;border-radius:999px;background:#eee3d7;color:#5b4632;font-weight:700}
    .timer{font-variant-numeric:tabular-nums; visibility:hidden;}
    .footer{position:fixed;left:0;right:0;bottom:0;background:rgba(255,255,255,.95);
      border-top:1px solid #e5e7eb;backdrop-filter: blur(6px)}
    .footer .inner{max-width:720px;margin:0 auto;padding:10px 16px;display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
    .result h2{margin:0 0 8px}
    .small{font-size:12px;color:#6b7280}
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1 id="title">八年級的回憶攻擊</h1>
    </header>

    <div id="last" class="card" style="display:none;margin-bottom:12px;"></div>

    <div id="quiz" class="card hidden">
      <div class="meta">
        <div><span id="progress" class="pill">1/1</span></div>
        <div class="timer">剩餘 <span id="remain">10:00</span></div>
      </div>
      <h2 id="q" class="q-text"></h2>
      <div id="choices" style="display:grid;gap:10px;"></div>
    </div>

    <div id="result" class="card hidden"></div>

    <div id="home" class="card">
      <p style="margin:0 0 12px;">這是手機瀏覽器就能玩的測驗。選擇模式開始作答：</p>
      <div class="row" style="margin-top:8px">
        <button id="start-free" class="btn">開始測驗（不限時）</button>
        <button id="start-10m" class="btn">開始測驗（限時 10 分鐘）</button>
      </div>
    </div>
  </div>

  <div class="footer">
    <div class="inner">
      <button id="back" class="btn hidden">返回</button>
      <button id="submit" class="btn hidden">交卷</button>
    </div>
  </div>

<script>
/** ===== 題庫 ===== */
const DEFAULT_BANK = [
  {"q":"下列哪個是哺乳類？","choices":["青蛙","鯨魚","麻雀","烏龜"],"answer":1},
  {"q":"2 + 2 = ?","choices":["3","4","5","22"],"answer":1},
  {"q":"台灣最高峰？","choices":["雪山","玉山","合歡主峰","南湖大山"],"answer":1},
  {"q":"地球是平的？","choices":["是","否"],"answer":1},
  {"q":"水在攝氏100度會沸騰？","choices":["是","否"],"answer":0},
  {"q":"人類可以在月球上呼吸？","choices":["是","否"],"answer":1}
];

const $ = sel => document.querySelector(sel);
let bank=[],idx=0,score=0,selected=null,enableTimer=false,duration=0,remaining=0,tick=null,startedAt=null;

function shuffle(arr){ return arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(v=>v[1]); }

$('#start-free').onclick=()=>startQuiz({timed:false});
$('#start-10m').onclick=()=>startQuiz({timed:true,seconds:600});
$('#back').onclick=()=>goHome();
$('#submit').onclick=()=>finishQuiz();

function startQuiz({timed,seconds=0}){ 
  bank=shuffle(DEFAULT_BANK);
  idx=0;score=0;selected=null;startedAt=Date.now();
  enableTimer=!!timed;duration=seconds;remaining=duration;clearInterval(tick);
  $('#home').classList.add('hidden');
  $('#result').classList.add('hidden');
  $('#quiz').classList.remove('hidden');
  renderQuestion();
  if(enableTimer){
    tick=setInterval(()=>{remaining--; if(remaining<=0){finishQuiz();}},1000);
  }
}

function renderQuestion(){
  const q=bank[idx];
  // 打亂選項並記錄正確答案
  const choicesWithIndex=q.choices.map((c,i)=>({text:c,idx:i}));
  const shuffled=shuffle(choicesWithIndex);
  q._choices=shuffled.map(c=>c.text);
  q._answer=shuffled.findIndex(c=>c.idx===q.answer);

  $('#progress').textContent=`${idx+1}/${bank.length}`;
  $('#q').textContent=q.q;
  const box=$('#choices'); box.innerHTML='';
  q._choices.forEach((text,i)=>{
    const div=document.createElement('label');
    div.className='choice';
    div.innerHTML=`<input type="radio" name="c${idx}" /> <span>${text}</span>`;
    div.onclick=()=>{selected=i; updateButtons();};
    box.appendChild(div);
  });
  updateButtons();
}

function updateButtons(){
  $('#back').classList.remove('hidden');
  if(idx===bank.length-1){ // 最後一題
    $('#submit').classList.remove('hidden');
  }else{
    $('#submit').classList.add('hidden');
  }
}

function goHome(){
  clearInterval(tick);
  $('#quiz').classList.add('hidden');
  $('#result').classList.add('hidden');
  $('#home').classList.remove('hidden');
  $('#back').classList.add('hidden');
  $('#submit').classList.add('hidden');
}

function finishQuiz(){
  clearInterval(tick);
  if(selected!==null && idx<bank.length){
    if(selected===bank[idx]._answer) score++;
  }
  const elapsed=Math.max(1,Math.round((Date.now()-startedAt)/1000));
  const total=bank.length;
  const pct=Math.round((score/total)*100);

  $('#result').innerHTML=`
    <h2>成績：${score} / ${total}</h2>
    <p class="small">正確率 ${pct}% ・ 花費 ${elapsed} 秒${enableTimer?`（限時 ${duration/60} 分鐘）`:''}</p>
    <div class="row" style="margin-top:8px">
      <button class="btn" onclick="startQuiz({timed:${enableTimer},seconds:${duration}})">再測一次</button>
      <button class="btn ghost" onclick="goHome()">回首頁</button>
    </div>`;
  $('#quiz').classList.add('hidden');
  $('#home').classList.add('hidden');
  $('#result').classList.remove('hidden');
  $('#back').classList.add('hidden');
  $('#submit').classList.add('hidden');
}
</script>
</body>
</html>
